(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["view-CardPayment-vue","view-NotificationMessage-vue"],{2074:function(e,t,s){},"490a":function(e,t,s){"use strict";s("2074");var i=s("b64a"),r=s("58df");t["a"]=Object(r["a"])(i["a"]).extend({name:"v-progress-circular",props:{button:Boolean,indeterminate:Boolean,rotate:{type:[Number,String],default:0},size:{type:[Number,String],default:32},width:{type:[Number,String],default:4},value:{type:[Number,String],default:0}},computed:{calculatedSize:function(){return Number(this.size)+(this.button?8:0)},circumference:function(){return 2*Math.PI*this.radius},classes:function(){return{"v-progress-circular--indeterminate":this.indeterminate,"v-progress-circular--button":this.button}},normalizedValue:function(){return this.value<0?0:this.value>100?100:parseFloat(this.value)},radius:function(){return 20},strokeDashArray:function(){return Math.round(1e3*this.circumference)/1e3},strokeDashOffset:function(){return(100-this.normalizedValue)/100*this.circumference+"px"},strokeWidth:function(){return Number(this.width)/+this.size*this.viewBoxSize*2},styles:function(){return{height:this.calculatedSize+"px",width:this.calculatedSize+"px"}},svgStyles:function(){return{transform:"rotate("+Number(this.rotate)+"deg)"}},viewBoxSize:function(){return this.radius/(1-Number(this.width)/+this.size)}},methods:{genCircle:function(e,t,s){return e("circle",{class:"v-progress-circular__"+t,attrs:{fill:"transparent",cx:2*this.viewBoxSize,cy:2*this.viewBoxSize,r:this.radius,"stroke-width":this.strokeWidth,"stroke-dasharray":this.strokeDashArray,"stroke-dashoffset":s}})},genSvg:function(e){var t=[this.indeterminate||this.genCircle(e,"underlay",0),this.genCircle(e,"overlay",this.strokeDashOffset)];return e("svg",{style:this.svgStyles,attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:this.viewBoxSize+" "+this.viewBoxSize+" "+2*this.viewBoxSize+" "+2*this.viewBoxSize}},t)}},render:function(e){var t=e("div",{staticClass:"v-progress-circular__info"},this.$slots.default),s=this.genSvg(e);return e("div",this.setTextColor(this.color,{staticClass:"v-progress-circular",attrs:{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":this.indeterminate?void 0:this.normalizedValue},class:this.classes,style:this.styles,on:this.$listeners}),[s,t])}})},"58df":function(e,t,s){"use strict";s.d(t,"a",function(){return r});var i=s("2b0e");function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return i["default"].extend({mixins:t})}},"59ef":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("transition",{attrs:{name:"slide-notification",appear:""}},[s("div",{staticClass:"notification",class:{light:e.light},on:{click:function(t){return e.close()}}},[s("div",{staticClass:"msg",domProps:{innerHTML:e._s(e.msg)}})])])},r=[],a=s("9ab4"),n=s("60a3");let o=class extends n["c"]{constructor(){super(...arguments),this.autoHide=5e3}mounted(){this.hold||setTimeout(()=>this.close(),this.autoHide)}close(){this.$emit("close")}};a["__decorate"]([Object(n["b"])()],o.prototype,"msg",void 0),a["__decorate"]([Object(n["b"])({type:Boolean})],o.prototype,"light",void 0),a["__decorate"]([Object(n["b"])({type:Boolean})],o.prototype,"hold",void 0),o=a["__decorate"]([Object(n["a"])({components:{}})],o);var c=o,l=c,h=(s("5bc5"),s("2877")),d=Object(h["a"])(l,i,r,!1,null,"5463e194",null);t["default"]=d.exports},"5bc5":function(e,t,s){"use strict";var i=s("deeb"),r=s.n(i);r.a},8143:function(e,t,s){},"87a5":function(e,t,s){"use strict";var i=s("8143"),r=s.n(i);r.a},b64a:function(e,t,s){"use strict";var i=s("2b0e"),r=function(){function e(e,t){var s=[],i=!0,r=!1,a=void 0;try{for(var n,o=e[Symbol.iterator]();!(i=(n=o.next()).done);i=!0)if(s.push(n.value),t&&s.length===t)break}catch(c){r=!0,a=c}finally{try{!i&&o["return"]&&o["return"]()}finally{if(r)throw a}}return s}return function(t,s){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,s);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e};function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function o(e){return!!e&&!!e.match(/^(#|(rgb|hsl)a?\()/)}t["a"]=i["default"].extend({name:"colorable",props:{color:String},methods:{setBackgroundColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o(e)?t.style=a({},t.style,{"background-color":""+e,"border-color":""+e}):e&&(t.class=a({},t.class,n({},e,!0))),t},setTextColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(o(e))t.style=a({},t.style,{color:""+e,"caret-color":""+e});else if(e){var s=e.toString().trim().split(" ",2),i=r(s,2),c=i[0],l=i[1];t.class=a({},t.class,n({},c+"--text",!0)),l&&(t.class["text--"+l]=!0)}return t}}})},deeb:function(e,t,s){},eca9:function(e,t,s){"use strict";var i=s("9ab4"),r=s("60a3"),a=s("b99e");let n=class extends r["c"]{constructor(){super(...arguments),this.profile=null}get isReady(){return null!==this.profile}get isStudent(){return a["a"].isStudent}created(){a["a"].isAuthenticated&&this.update(),this.$watch(()=>a["a"].isAuthenticated,e=>{e?this.update():this.profile=null})}update(){(a["a"].isStudent?a["a"].client.call.student.me():a["a"].client.call.trainer.me()).response.then(e=>{this.profile=e})}getProfileWhenReady(){return this.isReady?Promise.resolve(this.profile):new Promise((e,t)=>{const s=this.$watch(()=>this.profile,t=>{s(),e(t)})})}};n=i["__decorate"]([Object(r["a"])({components:{}})],n),t["a"]=new n},fde4:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.errMessage?s("NotificationMessage",{attrs:{msg:e.errMessage,light:""},on:{close:function(t){e.errMessage=null}}}):e._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.processingPayment,expression:"!processingPayment"}],staticClass:"payment-wrapp"},[s("div",{staticClass:"payment"},[s("div",{staticClass:"session-data"},[s("div",{staticClass:"total"},[e._v(e._s(e.$t("message")))]),s("div",{staticClass:"session-info"},[e._v(e._s((30===this.duration?25:55)+"m Session"))])]),e.sessionTickets.length?s("div",{staticClass:"session-ticket"},[s("div",{staticClass:"text-xs-center"},[e._v(" "+e._s(e.sessionTickets.length+" session "+(1===e.sessionTickets.length?e.$t("cardPayment.ticket"):e.$t("cardPayment.tickets")))+" "+e._s(e.$t("cardPayment.remaining")))])]):s("div",{staticClass:"card-voucher"},[e.hasSavedCards&&!e.showCards?s("div",{staticClass:"saved-card"},[s("span",[e._v(e._s(e.savedCards[e.activeCardIdx].Card.Brand.toUpperCase()+" "+e.savedCards[e.activeCardIdx].Card.Last4))]),s("a",{on:{click:function(t){e.showCards=!0}}},[e._v(e._s(e.$t("change")))])]):e._e(),e.showCards?s("div",{staticClass:"cards-list"},[s("ul",e._l(e.savedCards,function(t,i){return s("li",{key:i},[s("span",[e._v(e._s(t.Card.Brand.toUpperCase()+" "+t.Card.Last4))]),s("a",{on:{click:function(t){return e.chooseCard(i)}}},[e._v(e._s(e.$t("choose")))])])}),0)]):e._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.hasSavedCards&&e.isEmailVerified,expression:"!hasSavedCards && isEmailVerified"}],ref:"card",attrs:{id:"card-element"}})])]),s("div",{staticClass:"btn-group hidden-sm-and-down"},[s("button",{staticClass:"close",attrs:{type:"button"},on:{click:e.cancel}},[e._v(e._s(e.$t("close")))]),s("button",{staticClass:"submit",attrs:{type:"button",disabled:e.processingPayment||e.showCards},on:{click:e.processPayment}},[e._v(e._s(e.sessionTickets.length?"Use Ticket":"Pay"))])]),s("div",{staticClass:"btn-group fixed hidden-md-and-up"},[s("button",{staticClass:"close",attrs:{type:"button"},on:{click:function(t){return e.$emit("close")}}},[e._v(e._s(e.$t("close")))]),s("button",{staticClass:"submit",attrs:{type:"button",disabled:e.processingPayment||e.showCards},on:{click:e.processPayment}},[e._v(e._s(e.sessionTickets.length?"Use Ticket":"Pay"))])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.processingPayment,expression:"processingPayment"}],staticClass:"processing-payment"},[s("div",{staticClass:"h3"},[e._v("Please Wait")]),s("v-progress-circular",{staticClass:"preloader",attrs:{indeterminate:"",size:50}}),s("span",[e._v("Processing payment, thank you for your patience.")])],1)],1)},r=[],a=s("9ab4"),n=s("60a3"),o=s("b99e"),c=s("eca9"),l=s("59ef");let h=class extends n["c"]{constructor(){super(...arguments),this.card=null,this.voucher="",this.processingPayment=null,this.stripe=window.Stripe("pk_live_E7gqk2hsyg4LKBsNkoAqCvVv"),this.elements=this.stripe.elements(),this.isCardEmpty=!0,this.errMessage=null,this.savedCards=null,this.activeCardIdx=null,this.showCards=null,this.sessionTickets=[],this.cardOptions={style:{base:{color:"white",fontSize:"16px",fontWeight:"300","::placeholder":{color:"white"}},invalid:{color:"rgba(255, 255, 255, .7)"}},hidePostalCode:!0}}created(){o["a"].client.call.sessionTickets.get().response.then(e=>{this.sessionTickets=e})}isProfileReady(){return c["a"].isReady}get isEmailVerified(){return c["a"].isReady?c["a"].profile.IsEmailAddressVerified:null}get hasSavedCards(){return null!==this.savedCards&&0!==this.savedCards.length}mounted(){this.initPaymentForm(),c["a"].getProfileWhenReady().then(e=>{})}initPaymentForm(){this.isPossibleToBook().then(e=>{e?this.getSessionTickets().then(e=>this.sessionTickets=e):(this.card=this.elements.create("card",this.cardOptions),this.card.mount(this.$refs.card),this.card.on("change",this.checkCard),this.getSavedCards())})}checkCard(e){this.isCardEmpty=e.empty}isPossibleToBook(){return o["a"].client.call.booking.canBook().response.then(e=>e.IsPossible)}getSessionTickets(){return o["a"].client.call.sessionTickets.get().response.then(e=>e)}getSavedCards(){o["a"].client.call.payments.paymentMethodsGet("card").response.then(e=>{this.savedCards=[].slice.call(e),this.activeCardIdx=0})}chooseCard(e){this.activeCardIdx=e,this.showCards=null}processPayment(){(null!==this.sessionTickets&&this.sessionTickets.length>=0||null!==this.savedCards&&this.savedCards.length||!this.isCardEmpty||this.voucher.trim().length)&&(this.processingPayment=!0,this.trackPurchase(!0)),this.sessionTickets.length>=0?this.postBooking():this.voucher.trim().length?this.payWithVoucher():null!==this.savedCards&&this.savedCards.length&&null!==this.activeCardIdx?this.payWithCard(this.savedCards[this.activeCardIdx].Id):this.isCardEmpty?this.errMessage="Card and Voucher fields are empty.":this.payWithCard()}payWithCard(e){this.getPaymentIntent().then(t=>{(e?this.handleCardPayment(t.Secret,e):this.handleCardPayment(t.Secret)).then(e=>{e.error?(this.errMessage=e.error.message,this.processingPayment=null):this.isPossibleToBook().then(e=>{if(e)this.postBooking();else{let e=0;const t=setInterval(()=>{null!==e&&e<5?(e++,this.isPossibleToBook().then(t=>{t&&(e=null,this.postBooking())})):(clearInterval(t),5===e&&(this.errMessage="Network connection failed, please try again.",this.processingPayment=null))},4e3)}})})})}getPaymentIntent(){return o["a"].client.call.payments.post(this.duration).response.then(e=>e)}handleCardPayment(e,t){return t?this.stripe.handleCardPayment(e,{payment_method:t}):this.stripe.handleCardPayment(e,this.card)}payWithVoucher(){this.redeemVoucher().then(e=>{e?this.isPossibleToBook().then(e=>{e&&this.postBooking()}):this.errMessage="Error: Failed to process request. Voucher is invalid"}).catch(e=>{throw this.errMessage=e,setTimeout(()=>this.processingPayment=null,600),e})}redeemVoucher(){return o["a"].client.call.sessionTickets.redeemVoucher(this.voucher).response.then(e=>{return!!e.length})}postBooking(){this.trackPurchase(!1),setTimeout(()=>{this.$emit("postBooking"),this.processingPayment=null},800)}cancel(){this.$emit("close")}trackPurchase(e){Date.now().toString(10),this.duration}};a["__decorate"]([Object(n["b"])()],h.prototype,"duration",void 0),h=a["__decorate"]([Object(n["a"])({components:{NotificationMessage:l["default"]}})],h);var d=h,u=d,p=(s("87a5"),s("2877")),v=s("6544"),m=s.n(v),g=s("490a"),f=Object(p["a"])(u,i,r,!1,null,"65611b38",null);t["default"]=f.exports;m()(f,{VProgressCircular:g["a"]})}}]);
//# sourceMappingURL=view-CardPayment-vue.4f10fc21.js.map